hooks:
  SessionEnd:
    command: |
      #!/bin/bash

      # Read hook data from stdin
      read -r HOOK_DATA

      # Parse the JSON input
      SESSION_ID=$(echo "$HOOK_DATA" | jq -r '.session_id // "unknown"')
      TRANSCRIPT_PATH=$(echo "$HOOK_DATA" | jq -r '.transcript_path // ""')
      CWD=$(echo "$HOOK_DATA" | jq -r '.cwd // ""')
      REASON=$(echo "$HOOK_DATA" | jq -r '.reason // "exit"')

      # Generate timestamp
      TIMESTAMP=$(date +"%Y-%m-%d-%H%M")

      # Set output file path
      DOCS_DIR="${CWD}/docs"
      OUTPUT_FILE="${DOCS_DIR}/${TIMESTAMP}.txt"

      # Ensure docs directory exists
      mkdir -p "$DOCS_DIR" || true

      # Check if transcript file exists
      if [ -z "$TRANSCRIPT_PATH" ] || [ ! -f "$TRANSCRIPT_PATH" ]; then
        echo "Warning: Transcript file not found at: $TRANSCRIPT_PATH"
        exit 0
      fi

      # Create the output file with header and conversation
      {
        echo ""
        echo " ▐▛███▜▌   Claude Code v2.0.55"
        echo "▝▜█████▛▘  Sonnet 4.5 · Claude Pro"
        echo "  ▘▘ ▝▝    ~/lifecoach"
        echo ""

        # Extract the conversation from JSONL format
        # Each line in JSONL is a complete JSON object
        while IFS= read -r line; do
          # Try to extract role and content from each message
          role=$(echo "$line" | jq -r '.role // ""')
          content=$(echo "$line" | jq -r '.content // ""')

          if [ "$role" = "user" ]; then
            echo "> $content"
            echo ""
          elif [ "$role" = "assistant" ]; then
            echo "● $content"
            echo ""
          fi
        done < "$TRANSCRIPT_PATH"

        echo ""
        echo ""
      } > "$OUTPUT_FILE"

      # Print confirmation message
      echo "Session transcript saved to: $OUTPUT_FILE" 
